<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- jQuery -->
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

      <!-- Atlassian User Interface (AUI) -->
      <link rel="stylesheet" href="//aui-cdn.atlassian.com/aui-adg/5.7.0/css/aui.css" media="all">
      <script src="//aui-cdn.atlassian.com/aui-adg/5.7.0/js/aui.js"></script>

      <!-- Helper Javascript lib -->
      <script src="utils.js" type="text/javascript"></script>
      <script src="https://d3js.org/d3.v3.min.js"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.min.js"></script>

      <script>
        $(document).ready(function () {
           var allJS = Utils.getBaseUrl() + '/all.js';
           $.getScript(allJS, function () {});
        });
      </script>

      <style>
        main {
          margin: auto;
          width: 50%;
          padding: 10px;
        }
        h5 {
          display: inline;
          padding: 12px;
        }
        canvas {
          width: 100%;
          height: 100%;
          margin: 0px;
        }
        /*body {
          margin: 0px;
          padding: 0px:
        }*/
      </style>

   </head>
   <body id="main-body">
     <main>
       <canvas id="chart" width = "425" height = "500"></canvas>
       <div style="text-align:center;">
         <div id="filter-labels">

         </div>
         <h4>Total Cases: 0</h4>
         <button id="primary-action-button" class="aui-button aui-button-primary">Generate Graph</button>
       </div>
     </main>
     <script type="text/javascript">

       $('#primary-action-button').click(function () {

         var filterArr = [];
         var dataArr = [];
         var data;
         var title;
         $.ajax('https://sheetsu.com/apis/v1.0/70989698b61a')
          .done(function(data) {
            var i;
            var len = data.length;
            var total = 0;
            data = data;
            var totalArr = [];
            var passArr = [];
            var failArr = [];
            var blockedArr = [];
            var wipArr = [];
            var unexecutedArr = [];

            for (i = 0, len; i < len; ++i) {
              if (i === 0) {
                //$('h1').text(data[i].Title);
                title = data[i].Title;
              } else {
                filterArr.push(data[i].Filter);

                passArr.push(data[i].Pass);
                failArr.push(data[i].Fail);
                blockedArr.push(data[i].Blocked);
                wipArr.push(data[i].WIP);
                unexecutedArr.push(data[i].Unexecuted);

                var parsed = parseInt(data[i].total);
                totalArr.push(data[i].total);
                total = parsed + total;
              }
            }


            $('h4').text('Total Cases: ' + total);

            barData = {
              labels: filterArr,
              datasets: [
                {
                  label: 'Pass',
                  backgroundColor: 'rgba(0,255,0,1)',
                  data: passArr
                },
                {
                  label: 'Fail',
                  backgroundColor: 'rgba(255,0,0,1)',
                  data: failArr
                },
                {
                  label: 'Blocked',
                  backgroundColor: 'rgba(255,255,102,1)',
                  data: blockedArr
                },
                {
                  label: 'WIP',
                  backgroundColor: 'rgba(0,0,255,1)',
                  data: wipArr
                },
                {
                  label: 'Unexecuted',
                  backgroundColor: 'rgba(204,102,153,1)',
                  data: unexecutedArr
                }
              ]
            }

            var context = document.getElementById('chart').getContext('2d');
            var chart = new Chart(context, {
              type: 'bar',
              data: barData,
              options: {
                title: {
                  display: true,
                  text: title,
                  fontSize: 22
                },
                responsive: false
              }
            });

          //console.log(filterArr);

          /*var barData = {
            labels: ['Pass', 'Fail', 'Blocked', 'WIP', 'Unexecuted'],
            datasets: [
              {
                label: filterArr[0],
                backgroundColor: 'rgba(0,153,51)',
                //data: [data[1].Pass, data[1].Fail, data[1].Blocked, data[1].WIP, data[1].Unexecuted]
                data: dataArr[0]
              },
              {
                label: filterArr[1],
                backgroundColor: 'rgba(0,153,51)',
                //data: [data[1].Pass, data[1].Fail, data[1].Blocked, data[1].WIP, data[1].Unexecuted]
                data: dataArr[1]
              },
              {
                label: filterArr[2],
                backgroundColor: 'rgba(0,153,51)',
                //data: [data[1].Pass, data[1].Fail, data[1].Blocked, data[1].WIP, data[1].Unexecuted]
                data: dataArr[2]
              }
            ]
          }*/


          });
       });

     </script>
   </body>
</html>
